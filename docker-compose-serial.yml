#This Docker-compose is what ties all the containers together.
#This makes for bringing up DMS Service easier
version: "3.3"
services:
  web:
    build:
      dockerfile: Dockerfile
      context: ./dms-lite
    restart: "always"
    depends_on:
      - mariadb
    ports:
      - "3000:3000"
    links:
      - mariadb
    environment:
      MYSQL_DATABASE: "${MYSQL_DATABASE}"
      MYSQL_USER: "${MYSQL_USER}"
      MYSQL_PASSWORD: "${MYSQL_PASSWORD}"

  serialwriter:
    depends_on:
      - mariadb
    restart: "always"
    build:
      dockerfile: Dockerfile
      context: ./serial-sql-writer
    volumes:
      - "/dev/ttyUSB0:/dev/ttyUSB0"
    privileged: true
    links:
      - mariadb
    environment:
      MYSQL_DATABASE: "${MYSQL_DATABASE}"
      MYSQL_USER: "${MYSQL_USER}"
      MYSQL_PASSWORD: "${MYSQL_PASSWORD}"

  mariadb:
    image: "lscr.io/linuxserver/mariadb"
    container_name: mariadb
    hostname: mariadb
    restart: "always"
    volumes:
      - "/var/lib/mysql/data:/var/lib/mysql/data"
      - "/var/lib/mysql/logs:/var/lib/mysql/logs"
      - /var/docker/mariadb/conf:/etc/mysql
    environment:
      MYSQL_ROOT_PASSWORD: "${MYSQL_ROOT_PASSWORD}"
      MYSQL_DATABASE: "${MYSQL_DATABASE}"
      MYSQL_USER: "${MYSQL_USER}"
      MYSQL_PASSWORD: "${MYSQL_PASSWORD}"
